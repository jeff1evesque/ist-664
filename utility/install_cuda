#!/bin/bash

## local variables
NVIDIA_CUDA_URL=https://developer.download.nvidia.com/compute/cuda/repos
CUDA_VERSION=10.0
REPO="ubuntu1604_$CUDA_VERSION.130-1_amd64.deb"

## download repository
wget "$NVIDIA_CUDA_URL/ubuntu1604/x86_64/cuda-repo-$REPO"

## base installer
sudo apt-get install -y build-essential
sudo dpkg -i "cuda-repo-$REPO"
sudo apt-key adv --fetch-keys "$NVIDIA_CUDA_URL/ubuntu1604/x86_64/7fa2af80.pub"
sudo apt-get update
sudo apt-get install -y cuda

## install package
sudo dpkg -i "cuda-repo-$REPO"
sudo apt-get -y update
sudo apt-get install -y cuda

## append to path
PATHOK=$(grep cuda /etc/environment)
if [ -z $PATHOK ]; then
    sed -e "/^PATH/s/\"$/:\/usr\/local\/cuda-$CUDA_VERSION\/bin\"/g" /etc/environment
fi

## verify installation
echo '======================================='
echo 'Cuda installed:\n'
echo "$(nvidia-smi)"
echo '======================================='
